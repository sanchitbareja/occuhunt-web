{% extends "base.html" %}
{% load static from staticfiles %}
{% load i18n %}
{% load url from future %}

{% block head_title %} - Get Ready for Your Next Job{% endblock %}

{% block extra_style %}

<style type="text/css">

.bold-statement {
  font-size: 100px;
  padding-top: 20px;
  padding-bottom: 0px;
  font-weight: 500;
  color: white;
  line-height: 1;
  margin-bottom: 0px;
}

.quote-statement {
  font-size: 27px;
  padding-top: 0px;
  padding-bottom: 20px;
  font-weight: 400;
  color: rgb(200,200,200);
  line-height: 1;
  margin-bottom: 0;
}

.explanation-statement {
  font-size: 20px;
  padding-top: 0px;
  padding-bottom: 20px;
  font-weight: 400;
  color: rgb(200,200,200);
  line-height: 1;
  margin-bottom: 0;
}

body {
  height:100%;
  background: url('http://thecodeplayer.com/uploads/media/gs.png');
  background: linear-gradient(rgba(196, 102, 0, 0.2), rgba(155, 89, 182, 0.2)), url('http://thecodeplayer.com/uploads/media/gs.png');
}

/*form styles*/
#msform {
  width: 60%;
  margin: 20px auto;
  text-align: center;
  position: relative;
}
#msform fieldset {
  background: white;
  border: 0 none;
  border-radius: 3px;
  box-shadow: 0 0 15px 1px rgba(0, 0, 0, 0.4);
  padding: 20px 30px;
  
  box-sizing: border-box;
  width: 80%;
  margin: 0 10%;
  
  /*stacking fieldsets above each other*/
  position: absolute;
}
/*Hide all except first fieldset*/
#msform fieldset:not(:first-of-type) {
  display: none;
}
/*inputs*/
#msform input, #msform textarea {
  padding: 15px;
  border: 1px solid #ccc;
  border-radius: 3px;
  margin-bottom: 10px;
  width: 100%;
  box-sizing: border-box;
  color: #2C3E50;
  font-size: 13px;
}
/*buttons*/
#msform .action-button {
  width: 100px;
  background: #70aab0;
  font-weight: bold;
  color: white;
  border: 0 none;
  border-radius: 1px;
  cursor: pointer;
  padding: 10px 5px;
  margin: 10px 5px;
}
#msform .action-button:hover, #msform .action-button:focus {
  box-shadow: 0 0 0 2px white, 0 0 0 3px #70aab0;
}
/*headings*/
.fs-title {
  font-size: 15px;
  text-transform: uppercase;
  color: #2C3E50;
  margin-bottom: 10px;
}
.fs-subtitle {
  font-weight: normal;
  font-size: 13px;
  color: #666;
  margin-bottom: 20px;
}
/*progressbar*/
#progressbar {
  margin-bottom: 30px;
  overflow: hidden;
  /*CSS counters to number the steps*/
  counter-reset: step;
}
#progressbar li {
  list-style-type: none;
  color: white;
  text-transform: uppercase;
  font-size: 9px;
  width: 30%;
  float: left;
  position: relative;
}
#progressbar li:before {
  content: counter(step);
  counter-increment: step;
  width: 20px;
  line-height: 20px;
  display: block;
  font-size: 10px;
  color: #333;
  background: white;
  border-radius: 3px;
  margin: 0 auto 5px auto;
}
/*progressbar connectors*/
#progressbar li:after {
  content: '';
  width: 100%;
  height: 2px;
  background: white;
  position: absolute;
  left: -50%;
  top: 9px;
  z-index: -1; /*put it behind the numbers*/
}
#progressbar li:first-child:after {
  /*connector not needed before the first step*/
  content: none; 
}
/*marking active/completed steps green*/
/*The number of the step and the connector before it = green*/
#progressbar li.active:before,  #progressbar li.active:after{
  background: #70aab0;
  color: white;
}

</style>

{% endblock %}

{% block extra_script %}

<!-- jQuery easing plugin -->
<script src="http://thecodeplayer.com/uploads/js/jquery.easing.min.js" type="text/javascript"></script>
<script type="text/javascript">

$(document).ready(function(){
  //jQuery time
  var current_fs, next_fs, previous_fs; //fieldsets
  var left, opacity, scale; //fieldset properties which we will animate
  var animating; //flag to prevent quick multi-click glitches

  $(".next").click(function(){
    if(animating) return false;
    animating = true;
    
    current_fs = $(this).parent();
    next_fs = $(this).parent().next();
    
    //activate next step on progressbar using the index of next_fs
    $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
    
    //show the next fieldset
    next_fs.show(); 
    //hide the current fieldset with style
    current_fs.animate({opacity: 0}, {
      step: function(now, mx) {
        //as the opacity of current_fs reduces to 0 - stored in "now"
        //1. scale current_fs down to 80%
        scale = 1 - (1 - now) * 0.2;
        //2. bring next_fs from the right(50%)
        left = (now * 50)+"%";
        //3. increase opacity of next_fs to 1 as it moves in
        opacity = 1 - now;
        current_fs.css({'transform': 'scale('+scale+')'});
        next_fs.css({'left': left, 'opacity': opacity});
      }, 
      duration: 800, 
      complete: function(){
        current_fs.hide();
        animating = false;
      }, 
      //this comes from the custom easing plugin
      easing: 'easeInOutBack'
    });
  });

  $(".previous").click(function(){
    if(animating) return false;
    animating = true;
    
    current_fs = $(this).parent();
    previous_fs = $(this).parent().prev();
    
    //de-activate current step on progressbar
    $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");
    
    //show the previous fieldset
    previous_fs.show(); 
    //hide the current fieldset with style
    current_fs.animate({opacity: 0}, {
      step: function(now, mx) {
        //as the opacity of current_fs reduces to 0 - stored in "now"
        //1. scale previous_fs from 80% to 100%
        scale = 0.8 + (1 - now) * 0.2;
        //2. take current_fs to the right(50%) - from 0%
        left = ((1-now) * 50)+"%";
        //3. increase opacity of previous_fs to 1 as it moves in
        opacity = 1 - now;
        current_fs.css({'left': left});
        previous_fs.css({'transform': 'scale('+scale+')', 'opacity': opacity});
      }, 
      duration: 800, 
      complete: function(){
        current_fs.hide();
        animating = false;
      }, 
      //this comes from the custom easing plugin
      easing: 'easeInOutBack'
    });
  });

  $(".submit").click(function(){
    // resume drop
    var user_id = $("#user_id").val();
    var fair_id = $("#fair_id").val();
    var company_id = $("#company_id").val();
    var position = $("#companyPosition").val().join();
    console.log(position);

    // save user preferences
    // get major
    var majors = $("#studentMajor").val();
    // get graduation year
    var grad_year = $("#studentGradYear").val();
    // get degree type
    var degree_type = $("#studentDegree").val();
    // save all of these preferences
    console.log(majors);
    console.log(grad_year);
    console.log(degree_type);

    // submit resume
    if($("#resume_enabled").val() == 'False'){
      alert('Oops! You need to be logged in or have your resume uploaded to drop your resume with the employers!');
    } else {
      resumeDrop(user_id, company_id, fair_id, position, majors, grad_year, degree_type);
    }
    return false;
  });

  function resumeDrop(user_id, company_id, fair_id, position, majors, grad_year, degree_type){
    console.log("CONFIRMED");
    
    // new applications
    $.ajax({
      url: '/api/v1/applications/',
      type:'POST',
      dataType: 'json',
      data: JSON.stringify({
        'user_id': user_id, 
        'company_id': company_id,
        'fair_id': fair_id,
        'position': position,
        'status': 1,
        'majors':majors,
        'grad_year': grad_year,
        'degree_type': degree_type
      }),
      contentType: 'application/json',
      statusCode : {
        201: function(data, textStatus, jsXHR){
          console.log("successfully dropped resume!");
          console.log(data);
          console.log(textStatus);
          console.log(jsXHR);
          console.log($(this));
          // hide everything and show success message
          $("#msform").hide();
          $("#messages").append('<div class="row">'+
            '<div class="col-lg-2"></div>'+
            '<div class="col-lg-8 text-center">'+
              '<p class="quote-statement">We\'ve received your current offer. Please wait a couple of days before we get back to you! Do send us feedback at occuhunt@gmail.com or call us at 510-612-7328 if you need any assistance. Thanks!</p>'+
            '</div>'+
            '<div class="col-lg-2"></div>'+
          '</div>');
        },
        500: function(data, textStatus, jsXHR){
          console.log(data);
          console.log(textStatus);
          console.log(jsXHR);
          // give confirmation message about failed resume submission
          alert('Oops! You need to be logged in or have your resume uploaded to drop your resume with the employers!');
        },
        404: function(data, textStatus, jsXHR){
          console.log(data);
          console.log(textStatus);
          console.log(jsXHR);
          // give confirmation message about failed resume submission
          alert('Oops! You need to be logged in or have your resume uploaded to drop your resume with the employers!');
        }
      }
    });
    
    // if the student has offers
    var company_from_text_val = $("#companyFromText").val();
    var salary_range_val = $("#currentOfferSalaryRange").val();
    var offer_deadline_val = $("#currentOfferDeadline").val();
    var companies_interested_in_val = $("#companiesInterestedIn").val();
    if(company_from_text_val && salary_range_val && offer_deadline_val && companies_interested_in_val){
      $.ajax({
        url: '/api/v1/offers/',
        type: 'POST',
        dataType: 'json',
        data: JSON.stringify({
          'user_id': user_id,
          'company_from_text': company_from_text_val,
          'salary_range': salary_range_val,
          'offer_deadline': offer_deadline_val,
          'companies_interested_in': companies_interested_in_val
        }),
        contentType: 'application/json',
        statusCode: {
          201: function(data, textStatus, jsXHR) {
          },
          500: function(data, textStatus, jsXHR) {
          },
          404: function(data, textStatus, jsXHR) {
          }
        }
      });
    } else {
      alert("Oops! You've not missed something. Please check and try again.");
    }

  }

});

</script>


{% endblock %}

{% block full_content %}

<input type="hidden" name="fair_id" value="19" id="fair_id">
<input type="hidden" name="company_id" value="672" id="company_id">
<input type="hidden" name="resume_enabled" value="{{resume_url}}" id="resume_enabled">

<div class="row">
  <div class="col-lg-2"></div>
  <div class="col-lg-8 text-center">
    <p class="bold-statement">OffrHunt</p>
    <p class="quote-statement">Your leverage in job negotiation</p>
    <!-- <img style="width:400px;" src="{% static 'images/multiple_offers.png' %}"> -->
    <p class="explanation-statement">Have you ever been forced to accept a job offer because of lack of choice? You were not sure if you could have gotten more (and possibly better) offers? OffrHunt uses your current offer as a leverage in getting recruiters to respond quickly. If a company is interested in you, they'll most likely call you for their final round of interview (as opposed to going through three or four rounds) before deciding to extend an offer to you. This program is currently in beta so things may break but we'll do our best ot improve over time. Thanks!</p>
  </div>
  <div class="col-lg-2"></div>
</div>

<div id="messages"></div>

{% if current_offer %}
<div class="row">
  <div class="col-lg-2"></div>
  <div class="col-lg-8 text-center">
    <p class="quote-statement">We've received your current offer. Please wait a couple of days before we get back to you! Do send us feedback at occuhunt@gmail.com or call us at 510-612-7328 if you need any assistance. Thanks!</p>
  </div>
  <div class="col-lg-2"></div>
</div>

{% else %}
  {% if request.user.is_anonymous %}
  <div class="row">
    <div class="col-lg-2"></div>
    <div class="col-lg-8 text-center">
      <p class="quote-statement">You need to be logged-in to view this page.</p>
    </div>
    <div class="col-lg-2"></div>
  </div>
  {% else %}
  <!-- multistep form -->
  <form id="msform">
    <!-- progressbar -->
    <ul id="progressbar">
      <li class="active">Current Offer</li>
      <li>Companies Of Interest</li>
      <li>Final Check</li>
    </ul>
    <!-- fieldsets -->
    <fieldset>
      <h2 class="fs-title">Current Offer</h2>
      <h3 class="fs-subtitle">This is completely private and confidential</h3>
      <label>Company</label>
      <input type="text" name="companyOffer" id="companyFromText" placeholder="Company" />
      <br />
      <label>Offer Range</label>
      <select class="form-control input-lg" style="width:100%;" id="currentOfferSalaryRange">
        <option value="1">20k-30k</option>
        <option value="2">30k-40k</option>
        <option value="3">40k-50k</option>
        <option value="4">50k-60k</option>
        <option value="5">60k-70k</option>
        <option value="6">70k-80k</option>
        <option value="7">80k-100k</option>
        <option value="8">100k-120k</option>
        <option value="9">120k-140k</option>
        <option value="10">140k-160k</option>
        <option value="11">160k-180k</option>
        <option value="12">180k-200k</option>
        <option value="13">200k-250k</option>
        <option value="14">250k+</option>
        <option value="15">I do not wish to disclose</option>
      </select>
      <br />
      <label>Deadline to reply by?</label>
      <select class="form-control input-lg" style="width:100%;" id="currentOfferDeadline">
        <option value="1">In 3 days</option>
        <option value="2">In 7 days</option>
        <option value="3">In 14 days</option>
        <option value="4">In 28 days</option>
        <option value="5">I have time </option>
      </select>
      <br />
      <input type="button" name="next" class="next action-button" value="Next" />
    </fieldset>
    <fieldset>
      <h2 class="fs-title">Companies Of Interest</h2>
      <h3 class="fs-subtitle">Which companies do you want to consider applying to? Seperate them by commas (,). We've partnered with companies like Greylock, Dropbox, TubeMogul and etc. Name any company you are interested in and we'll make the connection for you!</h3>
      <textarea class="form-control" id="companiesInterestedIn">
      </textarea>
      <input type="button" name="previous" class="previous action-button" value="Previous" />
      <input type="button" name="next" class="next action-button" value="Next" />
    </fieldset>
    <fieldset>
      <h2 class="fs-title">Final Check</h2>
      <h3 class="fs-subtitle">Check your resume and details!</h3>
      <label>Major</label>
      <select multiple size="8" class="form-control" id="studentMajor" style="width:100%">
        {% for major in majors %}
          {% if major in request.user.student.major.all %}
            <option value="{{major.id}}" selected>{{major.major}}</option>
          {% else %}
            <option value="{{major.id}}">{{major.major}}</option>
          {% endif %}
        {% endfor %}
      </select>

      <br />
      <label>Job Interest</label>
      <select multiple size="8" class="form-control" id="companyPosition" style="width:100%">
        <option>Software Engineering</option>
        <option>Product Manager</option>
        <option>UI/UX Engineering</option>
        <option>Marketing</option>
        <option>Business Development</option>
        <option>Growth Hacker</option>
        <option>Accountant</option>
        <option>Other</option>
      </select>

      <br />
      <label>Degree Type</label>
      <select class="form-control" style="width:100%;" id="studentDegree">
        <option value=""></option>
        {% for degree_type in degree_types %}
          {% if request.user.student.degree.id == degree_type.id %}
            <option value="{{degree_type.id}}" selected>{{degree_type.degree}}</option>
          {% else %}
            <option value="{{degree_type.id}}">{{degree_type.degree}}</option>
          {% endif %}
        {% endfor %}
      </select>

      <br />
      <label>Graduation Year</label>
      {% if request.user.student.graduation_year %}
        <input type="text" class="input-text" style="width:100%;" placeholder="Graduation Year" id="studentGradYear" value="{{request.user.student.graduation_year}}">
      {% else %}
        <input type="text" class="input-text" placeholder="2015" id="studentGradYear" value="">
      {% endif %}

      <label>Resume</label>
      {% if request.user.is_anonymous %}
        <div class="thumbnail">
          <img src="{% static 'images/example-resume.png' %}">
          <div class="caption text-center">
            <p><a href="/login/linkedin/?next={{request.path}}" class="btn btn-login" style="font-weight:500;">LOG IN</a></p>
            <p>Login to activate Resume Drop</p>
          </div>
        </div>
      {% else %}
        {% if resume_url %}
          <div class="thumbnail">
            <img src="{{resume_url}}" alt="Resume">
            <div class="caption text-center">
              <p><a href="/showcase/" class="btn btn-done" role="button">Edit Profile</a></p>
            </div>
          </div>
        {% else %}
          <div class="thumbnail">
            <img src="{% static 'images/example-resume.png' %}" alt="Resume">
            <div class="caption text-center">
              <p><a href="/showcase/" class="btn btn-done" role="button">Add Resume</a></p>
              <p>We don't have your resume on file. Upload it to particapte in OffrHunt</p>
            </div>
          </div>
        {% endif %}
      {% endif %}

      <input type="button" name="previous" class="previous action-button" value="Previous" />
      {% if request.user.is_anonymous %}
      {% else %}
        {% if resume_url %}
          <input type="submit" name="submit" class="submit action-button" value="Submit" />
        {% endif %}
      {% endif %}
    </fieldset>
  </form>
  {% endif %}

{% endif %}

<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />

{% endblock %}

{% block footer_base %}

{% endblock %}